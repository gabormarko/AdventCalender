<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advent Calendar</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#b30000">

  <!-- iOS support -->
  <link rel="apple-touch-icon" href="media/app-icon-me.png">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <style>
@keyframes scaleUpBounce {
  0% { transform: scale(0.1); }
  60% { transform: scale(1.15); }
  80% { transform: scale(0.92); }
  100% { transform: scale(1); }
}

  .title-bg {
    display: flex;
    justify-content: center;
    align-items: center;
    background: url('media/wood5.jpg') center center/cover no-repeat;
    border-radius: 14px;
    margin-top: -20px;
    margin-bottom: 2px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.13);
    width: calc((4 * 80px + 3 * 8px)*1.1); /* match .calendar grid width */
    max-width: 100vw;
    height: 120px; 
    padding: 0;
    background-size: cover;
    background-repeat: no-repeat;
  }
    .title-bg h1 {
      margin: 0;
      line-height: 1.1;
      width: 100%;
      text-align: center;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      height: 100%;
      color: #fff;
      font-size: 1.56em;
      text-shadow:
        -1.3px -1.3px 0 #2d1807,
         1.3px -1.3px 0 #2d1807,
        -1.3px  1.3px 0 #2d1807,
         1.3px  1.3px 0 #2d1807,
         0px   1.2px 0 #2d1807,
         1.3px  0px 0 #2d1807,
        -1.3px  0px 0 #2d1807,
         0px  -1.3px 0 #2d1807,
         0 0 4px #2d1807;
      padding-bottom: 40px;
    }
                        @keyframes scaleUp {
                          0% { transform: scale(1); }
                          100% { transform: scale(1.18); }
                        }
                        .door.scale-up {
                          animation: scaleUp 0.18s;
                        }
                    @keyframes bounce {
                      0%   { transform: scale(1); }
                      20%  { transform: scale(1.2, 0.8); }
                      40%  { transform: scale(0.95, 1.05); }
                      60%  { transform: scale(1.15, 0.85); }
                      80%  { transform: scale(0.98, 1.02); }
                      100% { transform: scale(1); }
                    }

                    @keyframes shake {
                      0% { transform: translate(0, 0) scale(1); }
                      10%, 30%, 50%, 70%, 90% { transform: translate(-8px, 0) scale(1); }
                      20%, 40%, 60%, 80% { transform: translate(8px, 0) scale(1); }
                      100% { transform: translate(0, 0) scale(1); }
                    }

                    .door.bounce {
                      animation: bounce 0.4s;
                    }
                    .door.shake {
                      animation: shake 1.0s;
                    }
                    @keyframes pulse {
                      0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
                      70% { box-shadow: 0 0 0 12px rgba(255, 215, 0, 0); }
                      100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
                    }
                    .door.pulse {
                      animation: pulse 1.2s infinite;
                    }
                #loading-overlay .loading-message {
                  font-family: 'Comic Neue', Arial, sans-serif;
                  text-align: center;
                  font-size: 1em;
                  margin-bottom: 0.5em;
                  font-weight: bold;
                }
            #loading-powered {
            position: static;
            margin: 30px 0 10px 0;
            width: 100vw;
            text-align: center;
            font-size: 0.8em;
            color: #fff;
            opacity: 0.7;
            letter-spacing: 1px;
            font-family: 'Fira Mono', 'Consolas', 'Menlo', 'Monaco', monospace;
            pointer-events: none;
            }
        #loading-powered-overlay {
            position: fixed;
            bottom: 18px;
            left: 0;
            width: 100vw;
            text-align: center;
            font-size: 0.4em;
            color: #fff;
            opacity: 0.7;
            letter-spacing: 1px;
            font-family: 'Fira Mono', 'Consolas', 'Menlo', 'Monaco', monospace;
            z-index: 10000;
            pointer-events: none;
            }
        #loading-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: #b30000;
          color: white;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          font-size: 2em;
          z-index: 9999;
          transition: opacity 0.5s;
        }
    body {
      font-family: Arial, sans-serif;
      background: #f3f3f3 url('media/xmas.jpg') repeat;
      background-size: 200px 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }

    h1 {
      text-align: center;
      margin-top: 24px;
      margin-bottom: 8px;
      font-size: 1.4em;
      font-family: 'Comic Neue', Arial, sans-serif;
      font-weight: bold;
      color: #fff;
      text-shadow: none;
      /*text-shadow: 1px 1px 4px #ffffff, 0 0 2px #000;*/
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(4, 80px);
      grid-gap: 8px;
      margin-top: 30px;
    }

    .door {
      width: 70px;
      height: 70px;
      /* background: #b30000; */ /* original red background */
      border-radius: 8px;
      color: white;
      font-family: 'Comic Neue', Arial, sans-serif;
      display: flex;
      justify-content: flex-start;
      align-items: flex-end;
      font-size: 22px;
      cursor: pointer;
      transition: transform 0.2s;
      user-select: none;
      padding: 0 0 8px 10px;
      background-image: url('media/red-box3.png');
      background-size: cover;
      background-position: center;
    }

    .door.locked {
      /* background: #555; */ /* original grey background */
      background-image: url('media/grey-box2.png');
      background-size: cover;
      background-position: center;
      cursor: not-allowed;
    }

    .door:hover:not(.locked) {
      transform: scale(1.15);
    }

    #content {
      margin-top: 10px;
      padding: 16px;
      background: white;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: none;
    }

    #content p {
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    #content h1 {
      margin-top: -8px;
      margin-bottom: -8px;
      font-size: 1.3em;
      font-family: 'Comic Neue', Arial, sans-serif;
      font-weight: bold;
      color: #000000;
      text-shadow: none;
    }

    #content img,
    #content-overlay-center img,
    #content-overlay-center video {
      width: 100%;
      border-radius: 6px;
      display: block;
      margin: 10px auto;
      object-fit: contain;
    }

    #content-overlay-center {
      position: fixed;
      top: 48%;
      left: 50%;
      transform: translate(-50%, -52%);
      margin: 0;
      padding: 32px 16px 32px 16px;
      background: white;
      border-radius: 8px;
      width: 60vw;
      max-width: 500px;
      min-width: 280px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: block;
      overflow-y: auto;
      max-height: 76vh;
    }
    #content-overlay-center p {
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    #content-overlay-center h1 {
      margin-top: -8px;
      margin-bottom: -8px;
      font-size: 1.3em;
      font-family: 'Comic Neue', Arial, sans-serif;
      font-weight: bold;
      color: #000000;
      text-shadow: none;
    }
    /* Santa Day 6 Overlay Styles */
  #santa-overlay {
    display: none;
    position: fixed;
    z-index: 10001;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(2px);
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }
  #santa-overlay-top img,
  #xmas-overlay-top img {
    max-width: 280px;
    max-height: 180px;
  }
    #santa-overlay-center img,
    #xmas-overlay-center img {
      max-width: 270px;
      max-height: 270px;
      opacity: 0;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.18);
      background: #fff;
      padding: 8px;
    }
  #santa-overlay-bottom button,
  #xmas-overlay-bottom button {
    font-family: 'Comic Neue', Arial, sans-serif;
    font-size: 1.1em;
    padding: 10px 28px;
    background: #b30000;
    color: #fff;
    border: none;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    cursor: pointer;
    margin-bottom: 32px;
  }


  </style>
</head>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("Service worker registered"))
      .catch(err => console.error("Service worker error:", err));
  }
</script>

<body>
    <!-- Side drawer button (hidden until loading overlay is gone) -->
    <button id="drawer-btn" aria-label="Open menu" style="position:fixed;top:4px;left:4px;z-index:10010;width:38px;height:38px;border:none;background:none;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.13);display:flex;align-items:center;justify-content:center;cursor:pointer;display:none;">
      <span style="display:block;width:22px;height:3px;background:#ece3e3;border-radius:2px;box-shadow:0 7px 0 0 #ece3e3,0 14px 0 0 #ece3e3;"></span>
    </button>
    <!-- Side drawer overlay -->
    <div id="drawer-overlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:10009;"></div>
    <!-- Side drawer panel -->
    <nav id="drawer-panel" style="position:fixed;top:0;left:0;height:100vh;width:82vw;max-width:340px;background:#ffffff;box-shadow:2px 0 16px rgba(0,0,0,0.18);z-index:10011;transform:translateX(-100%);transition:transform 0.32s cubic-bezier(.7,0,.3,1);border-top-right-radius:18px;border-bottom-right-radius:18px;overflow-y:auto;">
      <div style="display:flex;align-items:center;justify-content:space-between;padding:18px 18px 8px 18px;">
        <span style="font-family:'Comic Neue',Arial,sans-serif;font-size:1.2em;color:#b30000;font-weight:bold;">Men√º</span>
        <button id="drawer-close" aria-label="Close menu" style="background:none;border:none;font-size:2em;line-height:1;color:#b30000;cursor:pointer;">&times;</button>
      </div>
      <div id="sidebar-accordion" style="padding:0 8px 18px 8px;">
        <div class="accordion-section">
          <button class="accordion-header" aria-expanded="false" style="width:100%;text-align:left;padding:14px 18px;font-family:'Comic Neue',Arial,sans-serif;font-size:1.08em;color:#b30000;background:none;border:none;outline:none;cursor:pointer;border-radius:8px;margin-top:2px;transition:background 0.2s;">‚ÑπÔ∏è Info</button>
          <div class="accordion-content" style="display:none;padding:0 18px 12px 18px;font-family:'Segoe UI',Arial,sans-serif;font-size:1em;color:#222;">
            <p style="margin-top:6px;">Ez az adventi kalend√°rium H√©ka J√∫lia (becenev√©n H√©k√°s Julis) sz√°m√°ra k√©sz√ºlt, sok szeretettel:)</p>
          </div>
        </div>
        <div class="accordion-section">
          <button class="accordion-header" aria-expanded="false" style="width:100%;text-align:left;padding:14px 18px;font-family:'Comic Neue',Arial,sans-serif;font-size:1.08em;color:#b30000;background:none;border:none;outline:none;cursor:pointer;border-radius:8px;margin-top:2px;transition:background 0.2s;">‚öôÔ∏è Be√°ll√≠t√°sok</button>
          <div class="accordion-content" style="display:none;padding:0 18px 12px 18px;font-family:'Segoe UI',Arial,sans-serif;font-size:1em;color:#222;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
              <label for="snow-toggle" style="font-size:1em;cursor:pointer;">‚ùÑÔ∏è H√≥es√©s:</label>
              <label class="switch">
                <input type="checkbox" id="snow-toggle" />
                <span class="slider"></span>
              </label>
            </div>
              <style>
              /* Toggle switch styles */
              .switch {
                position: relative;
                display: inline-block;
                width: 44px;
                height: 24px;
                vertical-align: middle;
              }
              .switch input {
                opacity: 0;
                width: 0;
                height: 0;
              }
              .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: .3s;
                border-radius: 24px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.08);
              }
              .slider:before {
                position: absolute;
                content: "";
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
                background-color: #fff;
                transition: .3s;
                border-radius: 50%;
                box-shadow: 0 1px 3px rgba(0,0,0,0.10);
              }
              .switch input:checked + .slider {
                background-color: #b30000;
              }
              .switch input:checked + .slider:before {
                transform: translateX(20px);
              }
              </style>            
          </div>
        
        </div>
        <div class="accordion-section">
          <button class="accordion-header" aria-expanded="false" style="width:100%;text-align:left;padding:14px 18px;font-family:'Comic Neue',Arial,sans-serif;font-size:1.08em;color:#b30000;background:none;border:none;outline:none;cursor:pointer;border-radius:8px;margin-top:2px;transition:background 0.2s;">üéì Egyetemre</button>
          <div class="accordion-content" style="display:none;padding:0 0 12px 0;font-family:'Segoe UI',Arial,sans-serif;font-size:1em;color:#222;">
            <div style="width:100%;display:flex;flex-direction:column;align-items:center;">
              <div id="game-selector" style="margin-bottom:12px;display:flex;gap:8px;justify-content:center;">
                <button class="game-select-btn" data-game="2048" style="padding:6px 16px;border-radius:6px;border:none;background:#b30000;color:#fff;font-family:'Comic Neue',Arial,sans-serif;cursor:pointer;font-size:1em;">2048</button>
                <button class="game-select-btn" data-game="snake" style="padding:6px 16px;border-radius:6px;border:none;background:#222;color:#fff;font-family:'Comic Neue',Arial,sans-serif;cursor:pointer;font-size:1em;">Snake</button>
                <button class="game-select-btn" data-game="sliding" style="padding:6px 16px;border-radius:6px;border:none;background:#222;color:#fff;font-family:'Comic Neue',Arial,sans-serif;cursor:pointer;font-size:1em;">Sliding Puzzle</button>
              </div>
              <div id="game-2048-container" style="width:100%;display:flex;justify-content:center;align-items:center;">
                <div id="game-2048" style="margin:0 auto;padding:8px 0;width:240px;">
                  <style>
                    .g2048-board { background:#eee;border-radius:8px;padding:8px;box-shadow:0 2px 8px rgba(0,0,0,0.08); }
                    .g2048-row { display:flex; }
                    .g2048-cell { width:48px;height:48px;margin:4px;background:#cdc1b4;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:1.2em;font-weight:bold;color:#776e65;transition:background 0.2s; }
                    .g2048-cell[data-v="2"] { background:#eee4da; }
                    .g2048-cell[data-v="4"] { background:#ede0c8; }
                    .g2048-cell[data-v="8"] { background:#f2b179;color:#fff; }
                    .g2048-cell[data-v="16"] { background:#f59563;color:#fff; }
                    .g2048-cell[data-v="32"] { background:#f67c5f;color:#fff; }
                    .g2048-cell[data-v="64"] { background:#f65e3b;color:#fff; }
                    .g2048-cell[data-v="128"] { background:#edcf72;color:#fff; }
                    .g2048-cell[data-v="256"] { background:#edcc61;color:#fff; }
                    .g2048-cell[data-v="512"] { background:#edc850;color:#fff; }
                    .g2048-cell[data-v="1024"] { background:#edc53f;color:#fff; }
                    .g2048-cell[data-v="2048"] { background:#edc22e;color:#fff; }
                    .g2048-score { text-align:center;font-size:1em;margin:6px 0 2px 0;color:#b30000;font-weight:bold; }
                    .g2048-btns { display:flex;justify-content:center;gap:8px;margin:4px 0; }
                    .g2048-btn { background:#b30000;color:#fff;border:none;border-radius:4px;padding:4px 10px;font-size:1em;cursor:pointer; }
                  </style>
                  <div class="g2048-score" id="g2048-score">Score: 0</div>
                  <div class="g2048-board" id="g2048-board"></div>
                  <div class="g2048-btns">
                    <button class="g2048-btn" id="g2048-restart">üîÑ</button>
                  </div>
                </div>
              </div>
              <div id="game-snake-container" style="width:100%;display:none;justify-content:center;align-items:center;">
                <div id="game-snake" style="margin:0 auto;padding:8px 0;width:320px;">
                  <!-- Snake game will be rendered here -->
                </div>
              </div>
              <div id="game-sliding-container" style="width:100%;display:none;justify-content:center;align-items:center;">
                <div id="game-sliding" style="margin:0 auto;padding:8px 0;width:320px;">
                  <!-- Sliding Puzzle game will be rendered here -->
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-section">
          <button class="accordion-header" aria-expanded="false" style="width:100%;text-align:left;padding:14px 18px;font-family:'Comic Neue',Arial,sans-serif;font-size:1.08em;color:#b30000;background:none;border:none;outline:none;cursor:pointer;border-radius:8px;margin-top:2px;transition:background 0.2s;">üò± Seg√≠ts√©√©√©√©g</button>
          <div class="accordion-content" style="display:none;padding:0 10px 12px 10px;font-family:'Segoe UI',Arial,sans-serif;font-size:1em;color:#222;">
            <p style="margin-top:6px;">K√©rd√©s, javaslat eset√©n a √≠rj b√°tran a gabo fejleszt≈ëcsapatnak!<br>√Ållunk rendelkez√©sedre!üòá<br><br>
              <button id="help-reveal-btn" style="display:block;margin:-8px auto 10px auto;padding:7px 18px;font-family:'Comic Neue',Arial,sans-serif;font-size:1em;color:#fff;background:#b30000;border:none;border-radius:8px;box-shadow:0 2px 6px #0002;cursor:pointer;">J√≥ lett az app!üòé</button>
              <div id="help-reveal" style="display:none;">
                <div id="help-typewriter-box" style="width:250px;height:188px;border-radius:14px;margin-top:0px;margin-bottom:4px;display:flex;align-items:center;justify-content:center;margin-left:auto;margin-right:auto;object-fit:cover;box-shadow:0 2px 8px rgba(179,0,0,0.10);background:#fffbe8;color:#b30000;font-family:'Comic Neue',Arial,sans-serif;font-size:1.8em;text-align:center;transition:opacity 0.5s;"></div>
                <img id="help-blur-img" src="media/gabo3.jpg" alt="gabo" style="width:250px;border-radius:14px;margin-top:0px;margin-bottom:4px;display:none;margin-left:auto;margin-right:auto;object-fit:cover;box-shadow:0 2px 8px rgba(179,0,0,0.10);transition:filter 0.5s;" />
                                <!-- The image will animate in with scaleUpBounce -->
                <audio id="help-audio" controls style="margin-top:2px;width:100%;max-width:300px;">
                  <source src="media/outro.mp3" type="audio/mpeg"> 
                </audio> 
                  <style>
                    .accordion-content audio { height: 28px; min-height: 28px; }
                  </style>
              </div>
              <span style="font-size:1em;color:#b30000;font-family:'Comic Neue',Arial,sans-serif;font-weight:bold;">Email:</span><br>
              <a href="mailto:gabor.marko@tum.de" style="color:#b30000;font-size:0.9em;word-break:break-all;">gabor.marko@tum.de</a>
              <br><br>
              <span style="display:block;text-align:center;font-size:0.73em;color:#b30000;font-family:'Comic Neue',Arial,sans-serif;opacity:0.85;margin-top:12px;">Copyright ¬© 2025 gabo | Minden jog fenntartva.<br>(b√°rmit is jelentsen ez)            
              </span>
            </p>
            <script>
              // Reveal image and audio on button click
              (function() {
                var btn = document.getElementById('help-reveal-btn');
                var reveal = document.getElementById('help-reveal');
                var img = document.getElementById('help-blur-img');
                var box = document.getElementById('help-typewriter-box');
                var audio = document.getElementById('help-audio');
                // Typewriter effect for 'k√∂szi...' cycling
                var typewriterText = 'k√∂szi...';
                var typewriterCharIdx = 0;
                var typewriterTimeout = null;
                var typewriterDelay = 120;
                var typewriterPause = 700;
                function typewriterStep() {
                  if (!box) return;
                  if (typewriterCharIdx <= typewriterText.length) {
                    box.textContent = typewriterText.slice(0, typewriterCharIdx);
                    typewriterCharIdx++;
                    typewriterTimeout = setTimeout(typewriterStep, typewriterDelay);
                  } else {
                    // Pause, then clear and restart
                    typewriterTimeout = setTimeout(function() {
                      box.textContent = '';
                      typewriterCharIdx = 0;
                      typewriterStep();
                    }, typewriterPause);
                  }
                }
                function startTypewriter() {
                  typewriterCharIdx = 0;
                  if (typewriterTimeout) clearTimeout(typewriterTimeout);
                  typewriterStep();
                }
                function stopTypewriter() {
                  if (typewriterTimeout) clearTimeout(typewriterTimeout);
                  if (box) box.textContent = '';
                }
                if (btn && reveal) {
                  btn.addEventListener('click', function() {
                    reveal.style.display = 'block';
                    if (box && img) {
                      box.style.display = 'flex';
                      img.style.display = 'none';
                      startTypewriter();
                    }
                  });
                }
                if (audio && img && box) {
                  let bounceTimeout = null;
                  let lastState = 'box'; // 'box' or 'img'
                  function animateImageDrop() {
                    img.style.animation = 'none';
                    img.style.transform = 'scale(0.1)';
                    // Force reflow to restart animation
                    void img.offsetWidth;
                    img.style.animation = 'scaleUpBounce 5s cubic-bezier(.7,0,.3,1)';
                    // After 5s, ensure image stays at full size
                    if (bounceTimeout) clearTimeout(bounceTimeout);
                    bounceTimeout = setTimeout(function() {
                      img.style.animation = 'none';
                      img.style.transform = 'scale(1)';
                    }, 5000);
                  }
                  function updateBoxAndImg() {
                    if (audio.currentTime < 52) {
                      if (lastState !== 'box') {
                        box.style.display = 'flex';
                        img.style.display = 'none';
                        if (!typewriterTimeout) startTypewriter();
                        lastState = 'box';
                      }
                    } else {
                      if (lastState !== 'img') {
                        box.style.display = 'none';
                        img.style.display = 'block';
                        animateImageDrop();
                        stopTypewriter();
                        lastState = 'img';
                      }
                    }
                  }
                  audio.addEventListener('timeupdate', updateBoxAndImg);
                  audio.addEventListener('play', updateBoxAndImg);
                  audio.addEventListener('seeked', updateBoxAndImg);
                  audio.addEventListener('ended', function() { box.style.display = 'none'; img.style.display = 'block'; animateImageDrop(); stopTypewriter(); lastState = 'img'; });
                  audio.addEventListener('loadedmetadata', updateBoxAndImg);
                }
              })();
            </script>
          </div>
        </div>
      </div>
    </nav>

<script>
// Side drawer logic (mobile friendly)
function initDrawerLogic() {
  const btn = document.getElementById('drawer-btn');
  if (btn) btn.style.display = 'flex'; // Show the button only after loading overlay is gone
  const panel = document.getElementById('drawer-panel');
  const overlay = document.getElementById('drawer-overlay');
  const closeBtn = document.getElementById('drawer-close');
  function openDrawer() {
    panel.style.transform = 'translateX(0)';
    overlay.style.display = 'block';
    document.body.style.overflow = 'hidden';
  }
  function closeDrawer() {
    panel.style.transform = 'translateX(-100%)';
    overlay.style.display = 'none';
    document.body.style.overflow = '';
  }
  btn.addEventListener('click', openDrawer);
  closeBtn.addEventListener('click', closeDrawer);
  overlay.addEventListener('click', closeDrawer);
  // Swipe to close (mobile)
  let startX = null;
  panel.addEventListener('touchstart', e => {
    if (e.touches.length === 1) startX = e.touches[0].clientX;
  });
  panel.addEventListener('touchmove', e => {
    if (startX !== null && e.touches.length === 1) {
      const dx = e.touches[0].clientX - startX;
      if (dx < -60) closeDrawer();
    }
  });
  panel.addEventListener('touchend', () => { startX = null; });
}

// Wait for loading overlay to finish before enabling drawer
window.addEventListener('DOMContentLoaded', () => {
      // Early morning swim message
      function showEarlySwimMessage() {
        // Only show once per day
        const todayStr = new Date().toISOString().slice(0, 10);
        const lastShown = localStorage.getItem('early-swim-last-shown');
        if (lastShown === todayStr) return;
        localStorage.setItem('early-swim-last-shown', todayStr);
        // Create overlay
        const msgOverlay = document.createElement('div');
        msgOverlay.style.position = 'fixed';
        msgOverlay.style.top = '0';
        msgOverlay.style.left = '0';
        msgOverlay.style.width = '100vw';
        msgOverlay.style.height = '100vh';
        msgOverlay.style.background = 'rgba(0,0,0,0.65)';
        msgOverlay.style.backdropFilter = 'blur(2px)';
        msgOverlay.style.zIndex = '10020';
        msgOverlay.style.display = 'flex';
        msgOverlay.style.justifyContent = 'center';
        msgOverlay.style.alignItems = 'center';
        msgOverlay.innerHTML = `<div style="background:#fff;padding:32px 24px;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.18);font-family:'Comic Neue',Arial,sans-serif;font-size:1.18em;color:#b30000;text-align:center;max-width:340px;">Uff... norm√°lis emberek ilyenkor m√©g alszanaküò¥<br><br>Na sebaj, j√≥ √∫sz√°st!üèä‚Äç‚ôÄÔ∏è<br><br><button id="close-early-msg" style="margin-top:18px;padding:8px 24px;font-size:1em;background:#b30000;color:#fff;border:none;border-radius:8px;cursor:pointer;">Hihi:) De √©n kem√©ny vagyok!</button></div>`;
        document.body.appendChild(msgOverlay);
        document.getElementById('close-early-msg').onclick = function() {
          msgOverlay.remove();
        };
      }
      function checkEarlySwim() {
        const now = new Date();
        const hour = now.getHours();
        const min = now.getMinutes();
        if ((hour === 4 && min >= 30) || (hour === 5 && min < 50) /*|| (hour === 17 && min < 57)*/) {
          return true;
        }
        return false;
      }
    // For testing: set OPEN_DAYS to a number to override the current day
    const OPEN_DAYS = 0; // 0 = use real date, >0 = override day
    const loadingOverlay = document.getElementById('loading-overlay');
    const shouldShowSwim = checkEarlySwim();
    function afterLoadingOverlayGone() {
      initDrawerLogic();
      if (shouldShowSwim) {
        setTimeout(showEarlySwimMessage, 200);
      }
    }
    if (!loadingOverlay) {
      afterLoadingOverlayGone();
      return;
    }
    const observer = new MutationObserver(() => {
      if (loadingOverlay.style.display === 'none' || loadingOverlay.style.opacity === '0') {
        afterLoadingOverlayGone();
        observer.disconnect();
      }
    });
    observer.observe(loadingOverlay, { attributes: true, attributeFilter: ['style'] });
    // Fallback: if overlay is already hidden
    if (loadingOverlay.style.display === 'none' || loadingOverlay.style.opacity === '0') {
      afterLoadingOverlayGone();
      observer.disconnect();
    }
});

<!-- Accordion logic moved to script below -->
// Sidebar accordion logic (moved from nav)
window.addEventListener('DOMContentLoaded', () => {
  const headers = document.querySelectorAll('.accordion-header');
  headers.forEach(header => {
    header.addEventListener('click', function() {
      const expanded = this.getAttribute('aria-expanded') === 'true';
      // Close all
      headers.forEach(h => {
        h.setAttribute('aria-expanded', 'false');
        h.nextElementSibling.style.display = 'none';
      });
      // Open this one if it was closed
      if (!expanded) {
        this.setAttribute('aria-expanded', 'true');
        this.nextElementSibling.style.display = 'block';
      }
    });
  });

  // Game selector logic
  const egyetemreHeader = Array.from(headers).find(h => h.textContent.includes('Egyetemre'));
  if (egyetemreHeader) {
    egyetemreHeader.addEventListener('click', function() {
      setTimeout(() => {
        // Only initialize 2048 if not already drawn
        if (document.getElementById('g2048-board') && !document.getElementById('g2048-board').hasChildNodes()) {
          g2048Init();
        }
      }, 100);
    });
  }
  // Game selector buttons
  const selector = document.getElementById('game-selector');
  if (selector) {
    // Lock logic
    let currentDay;
    if (typeof OPEN_DAYS !== 'undefined' && OPEN_DAYS !== 0) {
      currentDay = OPEN_DAYS;
    } else {
      const today = new Date();
      currentDay = today.getMonth() === 11 ? today.getDate() : 24;
    }
    const snakeBtn = selector.querySelector('.game-select-btn[data-game="snake"]');
    const puzzleBtn = selector.querySelector('.game-select-btn[data-game="sliding"]');
    if (snakeBtn) {
      if (currentDay < 8) {
        snakeBtn.disabled = true;
        snakeBtn.style.background = '#888';
        snakeBtn.style.color = '#ccc';
        snakeBtn.innerHTML = 'üîí (12.08)';
        snakeBtn.setAttribute('title', 'El√©rhet≈ë: 8. nap');
      } else {
        snakeBtn.disabled = false;
        snakeBtn.innerHTML = 'Snake';
        snakeBtn.style.color = '#fff';
      }
    }
    if (puzzleBtn) {
      if (currentDay < 15) {
        puzzleBtn.disabled = true;
        puzzleBtn.style.background = '#888';
        puzzleBtn.style.color = '#ccc';
        puzzleBtn.innerHTML = 'üîí (12.15)';
        puzzleBtn.setAttribute('title', 'El√©rhet≈ë: 15. nap');
      } else {
        puzzleBtn.disabled = false;
        puzzleBtn.innerHTML = 'Sliding Puzzle';
        puzzleBtn.style.color = '#fff';
      }
    }
    selector.addEventListener('click', function(e) {
      const btn = e.target.closest('.game-select-btn');
      if (!btn || btn.disabled) return;
      const game = btn.getAttribute('data-game');
      document.querySelectorAll('.game-select-btn').forEach(b => {
        b.style.background = (b.getAttribute('data-game') === game) ? '#b30000' : '#222';
      });
      document.getElementById('game-2048-container').style.display = (game === '2048') ? 'flex' : 'none';
      document.getElementById('game-snake-container').style.display = (game === 'snake') ? 'flex' : 'none';
      document.getElementById('game-sliding-container').style.display = (game === 'sliding') ? 'flex' : 'none';
      // Init games if needed
      if (game === '2048' && document.getElementById('g2048-board') && !document.getElementById('g2048-board').hasChildNodes()) {
        g2048Init();
      }
      if (game === 'snake' && typeof window.snakeInit === 'function') {
        window.snakeInit();
      }
      if (game === 'sliding' && typeof window.slidingInit === 'function') {
        window.slidingInit();
      }
    });
  }

  // 2048 game logic (minimal, mobile-friendly)
  function g2048Init() {
    const size = 4;
    let board = [];
    let score = 0;
    let highScore = parseInt(localStorage.getItem('g2048-highscore') || '0', 10);
    const boardDiv = document.getElementById('g2048-board');
    const scoreDiv = document.getElementById('g2048-score');
    function emptyBoard() {
      board = Array(size).fill().map(() => Array(size).fill(0));
    }
    function addRandom() {
      let empties = [];
      for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) if (!board[r][c]) empties.push([r, c]);
      if (empties.length) {
        let [r, c] = empties[Math.floor(Math.random() * empties.length)];
        board[r][c] = Math.random() < 0.9 ? 2 : 4;
      }
    }
    function draw() {
      boardDiv.innerHTML = '';
      for (let r = 0; r < size; r++) {
        let row = document.createElement('div');
        row.className = 'g2048-row';
        for (let c = 0; c < size; c++) {
          let cell = document.createElement('div');
          cell.className = 'g2048-cell';
          if (board[r][c]) {
            cell.textContent = board[r][c];
            cell.setAttribute('data-v', board[r][c]);
          }
          row.appendChild(cell);
        }
        boardDiv.appendChild(row);
      }
      scoreDiv.textContent = 'Score: ' + score + ' | Best: ' + highScore;
    }
    function move(dir) {
      let moved = false;
      function slide(row) {
        let arr = row.filter(x => x);
        for (let i = 0; i < arr.length - 1; i++) {
          if (arr[i] && arr[i] === arr[i + 1]) {
            arr[i] *= 2;
            score += arr[i];
            arr[i + 1] = 0;
          }
        }
        return arr.filter(x => x).concat(Array(size - arr.filter(x => x).length).fill(0));
      }
      if (dir === 'left') {
        for (let r = 0; r < size; r++) {
          let old = board[r].slice();
          let row = slide(board[r]);
          if (row.join() !== old.join()) moved = true;
          board[r] = row;
        }
      } else if (dir === 'right') {
        for (let r = 0; r < size; r++) {
          let old = board[r].slice();
          let row = slide(board[r].slice().reverse()).reverse();
          if (row.join() !== old.join()) moved = true;
          board[r] = row;
        }
      } else if (dir === 'up') {
        for (let c = 0; c < size; c++) {
          let col = board.map(row => row[c]);
          let old = col.slice();
          let newCol = slide(col);
          if (newCol.join() !== old.join()) moved = true;
          for (let r = 0; r < size; r++) board[r][c] = newCol[r];
        }
      } else if (dir === 'down') {
        for (let c = 0; c < size; c++) {
          let col = board.map(row => row[c]);
          let old = col.slice();
          let newCol = slide(col.reverse()).reverse();
          if (newCol.join() !== old.join()) moved = true;
          for (let r = 0; r < size; r++) board[r][c] = newCol[r];
        }
      }
      if (moved) {
        addRandom();
        draw();
        if (isGameOver()) setTimeout(() => {
          if (score > highScore) {
            highScore = score;
            localStorage.setItem('g2048-highscore', highScore);
          }
          draw();
          alert('Na j√≥, lehet most m√°r ink√°bb az √≥r√°ra k√©ne figyelni... Vagy?:D');
          restart();
        }, 100);
      }
    }
    function isGameOver() {
      for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) {
        if (!board[r][c]) return false;
        if (c < size - 1 && board[r][c] === board[r][c + 1]) return false;
        if (r < size - 1 && board[r][c] === board[r + 1][c]) return false;
      }
      return true;
    }
    function restart() {
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('g2048-highscore', highScore);
      }
      score = 0;
      emptyBoard();
      addRandom();
      addRandom();
      draw();
    }
    // Button event
    document.getElementById('g2048-restart').onclick = () => restart();
    // Keyboard events
    const gameDiv = document.getElementById('game-2048');
    gameDiv.tabIndex = 0;
    gameDiv.onkeydown = e => {
      if (e.key === 'ArrowUp') move('up');
      if (e.key === 'ArrowDown') move('down');
      if (e.key === 'ArrowLeft') move('left');
      if (e.key === 'ArrowRight') move('right');
    };

    // Touch swipe events for mobile
    let touchStartX = 0, touchStartY = 0, touchEndX = 0, touchEndY = 0;
    gameDiv.addEventListener('touchstart', function(e) {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }
      // Prevent sidebar swipe-to-close
      e.stopPropagation();
    });
    gameDiv.addEventListener('touchend', function(e) {
      touchEndX = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientX : 0;
      touchEndY = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientY : 0;
      const dx = touchEndX - touchStartX;
      const dy = touchEndY - touchStartY;
      if (Math.abs(dx) > 30 || Math.abs(dy) > 30) {
        if (Math.abs(dx) > Math.abs(dy)) {
          if (dx > 0) move('right');
          else move('left');
        } else {
          if (dy > 0) move('down');
          else move('up');
        }
      }
      // Prevent sidebar swipe-to-close
      e.stopPropagation();
    });

    restart();
  }
  window.g2048Init = g2048Init;

  // Snake and Sliding Puzzle stubs
  window.snakeInit = function() {
    const snakeDiv = document.getElementById('game-snake');
    if (!snakeDiv) return;
    // Prevent multiple initializations
    if (snakeDiv.getAttribute('data-initialized')) return;
    snakeDiv.setAttribute('data-initialized', '1');
    const snakeGridSize = 9;
    const snakeBox = 31;
    const snakeCanvasSize = snakeGridSize * snakeBox;
    // Snake modes: head and food images
    const snakeModes = [
      { head: 'media/snake1.jpg', food: 'media/food1.png' },
      { head: 'media/snake2.jpg', food: 'media/food2.jpg' }
    ];
    let modeIdx = parseInt(localStorage.getItem('snake-mode-idx')||'0',10) % snakeModes.length;
    let headImg, foodImg;
    function setNextModeAndLoad(cb) {
      modeIdx = (modeIdx + 1) % snakeModes.length;
      localStorage.setItem('snake-mode-idx', modeIdx);
      headImg = new window.Image();
      foodImg = new window.Image();
      let loaded = 0;
      let called = false;
      let headImgError = false, foodImgError = false;
      function afterLoad() {
        loaded++;
        if (loaded >= 2 && !called && typeof cb === 'function') {
          called = true;
          cb();
        }
      }
      headImg.onload = afterLoad;
      foodImg.onload = afterLoad;
      headImg.onerror = function() { headImgError = true; afterLoad(); };
      foodImg.onerror = function() { foodImgError = true; afterLoad(); };
      headImg.src = snakeModes[modeIdx].head;
      foodImg.src = snakeModes[modeIdx].food;
      if (headImg.complete) setTimeout(afterLoad, 0);
      if (foodImg.complete) setTimeout(afterLoad, 0);
    }
    function loadCurrentMode(cb) {
      headImg = new window.Image();
      foodImg = new window.Image();
      let loaded = 0;
      let called = false;
      let headImgError = false, foodImgError = false;
      function afterLoad() {
        loaded++;
        if (loaded >= 2 && !called && typeof cb === 'function') {
          called = true;
          cb();
        }
      }
      headImg.onload = afterLoad;
      foodImg.onload = afterLoad;
      headImg.onerror = function() { headImgError = true; afterLoad(); };
      foodImg.onerror = function() { foodImgError = true; afterLoad(); };
      headImg.src = snakeModes[modeIdx].head;
      foodImg.src = snakeModes[modeIdx].food;
      if (headImg.complete) setTimeout(afterLoad, 0);
      if (foodImg.complete) setTimeout(afterLoad, 0);
    }
    snakeDiv.innerHTML =
      `<div class="snake-score" style="text-align:center;font-size:1em;margin:6px 0 2px 0;color:#b30000;font-weight:bold;">Score: <span id="snake-score">0</span> | Best: <span id="snake-best">0</span></div>` +
      `<canvas id="snake-canvas" width="${snakeCanvasSize}" height="${snakeCanvasSize}" style="background:#222;border-radius:8px;display:block;margin:0 auto;"></canvas>` +
      '<div class="snake-btns" style="display:flex;justify-content:center;gap:8px;margin:8px 0 0 0;width:100%;">' +
        '<button id="snake-start" style="background:#b30000;color:#fff;border:none;border-radius:4px;padding:4px 16px;font-size:1em;cursor:pointer;">Start</button>' +
        '<button id="snake-restart" style="background:#b30000;color:#fff;border:none;border-radius:4px;padding:4px 10px;font-size:1em;cursor:pointer;">üîÑ</button>' +
      '</div>';
    const canvas = document.getElementById('snake-canvas');
    const ctx = canvas.getContext('2d');
    const box = snakeBox;
    const gridSize = snakeGridSize;
    let snake, dir, food, score, best, gameOver, movePending;
    function reset() {
      snake = [{x:4,y:7},{x:3,y:7},{x:2,y:7}];
      dir = 'right';
      food = spawnFood();
      score = 0;
      best = parseInt(localStorage.getItem('snake-best')||'0',10);
      gameOver = false;
      movePending = false;
      updateScore();
    }
    function spawnFood() {
      let pos;
      do {
        pos = {x:Math.floor(Math.random()*gridSize),y:Math.floor(Math.random()*gridSize)};
      } while (snake.some(s=>s.x===pos.x&&s.y===pos.y));
      return pos;
    }
    function updateScore() {
      document.getElementById('snake-score').textContent = score;
      document.getElementById('snake-best').textContent = best;
    }
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // Draw food
      if (foodImg && foodImg.complete && foodImg.naturalWidth && foodImg.naturalHeight) {
        ctx.drawImage(foodImg, food.x*box, food.y*box, box, box);
      } else {
        ctx.fillStyle = '#f2b179';
        ctx.fillRect(food.x*box, food.y*box, box, box);
      }
      // Draw snake
      for (let i=0;i<snake.length;i++) {
        if (i===0 && headImg && headImg.complete && headImg.naturalWidth && headImg.naturalHeight) {
          ctx.drawImage(headImg, snake[i].x*box, snake[i].y*box, box, box);
        } else if (i === 0) {
          ctx.fillStyle = '#b30000'; // fallback head color
          ctx.fillRect(snake[i].x*box, snake[i].y*box, box, box);
        } else {
          ctx.fillStyle = '#90ee90'; // light green for all body parts except head
          ctx.fillRect(snake[i].x*box, snake[i].y*box, box, box);
        }
      }
    }
    function move() {
      if (gameOver) return;
      let head = {...snake[0]};
      if (dir==='left') head.x--;
      if (dir==='right') head.x++;
      if (dir==='up') head.y--;
      if (dir==='down') head.y++;
      // Wall or self collision
      if (head.x<0||head.x>9||head.y<0||head.y>9||snake.some(s=>s.x===head.x&&s.y===head.y)) {
        gameOver = true;
        if (score>best) {
          best=score;
          localStorage.setItem('snake-best',best);
        }
        updateScore();
        setTimeout(()=>{
          alert('Hupsz! Tudsz te enn√©l jobbat is!:)');
          reset();
        },200);
        return;
      }
      snake.unshift(head);
      if (head.x===food.x&&head.y===food.y) {
        score++;
        if (score>best) {
          best=score;
          localStorage.setItem('snake-best',best);
        }
        food=spawnFood();
        updateScore();
      } else {
        snake.pop();
      }
      draw();
      movePending = false;
    }
    let interval = null;
    let snakeSpeed = 260; // ms, slower at start
    function setDir(newDir) {
      if (!interval) return; // Only allow direction change if game is running
      if (movePending) return;
      if (newDir==='left'&&dir!=='right') dir='left';
      if (newDir==='right'&&dir!=='left') dir='right';
      if (newDir==='up'&&dir!=='down') dir='up';
      if (newDir==='down'&&dir!=='up') dir='down';
      movePending = true;
    }
    // Keyboard
    snakeDiv.tabIndex=0;
    snakeDiv.onkeydown = e => {
      if (e.key==='ArrowLeft') setDir('left');
      if (e.key==='ArrowRight') setDir('right');
      if (e.key==='ArrowUp') setDir('up');
      if (e.key==='ArrowDown') setDir('down');
    };
    // Touch swipe
    let sx=0,sy=0,ex=0,ey=0;
    canvas.addEventListener('touchstart',e=>{
      if (e.touches.length===1) {
        sx=e.touches[0].clientX; sy=e.touches[0].clientY;
      }
      e.stopPropagation();
    });
    canvas.addEventListener('touchend',e=>{
      ex=(e.changedTouches&&e.changedTouches[0])?e.changedTouches[0].clientX:0;
      ey=(e.changedTouches&&e.changedTouches[0])?e.changedTouches[0].clientY:0;
      const dx=ex-sx, dy=ey-sy;
      if (Math.abs(dx)>20||Math.abs(dy)>20) {
        if (Math.abs(dx)>Math.abs(dy)) {
          if (dx>0) setDir('right'); else setDir('left');
        } else {
          if (dy>0) setDir('down'); else setDir('up');
        }
      }
      e.stopPropagation();
    });
    // Start and Restart button logic
    const startBtn = document.getElementById('snake-start');
    const restartBtn = document.getElementById('snake-restart');
    function startGame() {
      if (interval) clearInterval(interval);
      interval = setInterval(move, snakeSpeed);
      startBtn.style.display = 'none';
      setTimeout(()=>{snakeDiv.focus();},200);
    }
    function pauseGame() {
      if (interval) clearInterval(interval);
      interval = null;
      startBtn.style.display = '';
    }
    startBtn.onclick = startGame;
    restartBtn.onclick = () => {
      setNextModeAndLoad(() => {
        reset();
        draw();
        pauseGame();
      });
    };
    // On initial load, ensure images are loaded before first draw
    loadCurrentMode(() => {
      reset();
      draw();
      pauseGame();
    });
    // On game over, show Start button again
    const oldMove = move;
    move = function() {
      if (gameOver) return;
      let head = {...snake[0]};
      if (dir==='left') head.x--;
      if (dir==='right') head.x++;
      if (dir==='up') head.y--;
      if (dir==='down') head.y++;
      // Wall or self collision
      if (head.x<0||head.x>=gridSize||head.y<0||head.y>=gridSize||snake.some(s=>s.x===head.x&&s.y===head.y)) {
        gameOver = true;
        if (score>best) {
          best=score;
          localStorage.setItem('snake-best',best);
        }
        updateScore();
        setTimeout(()=>{
          alert('Hupsz! Tudsz te enn√©l jobbat is!:)');
          setNextModeAndLoad(() => {
            reset();
            draw();
            pauseGame();
          });
        },200);
        return;
      }
      snake.unshift(head);
      if (head.x===food.x&&head.y===food.y) {
        score++;
        if (score>best) {
          best=score;
          localStorage.setItem('snake-best',best);
        }
        food=spawnFood();
        updateScore();
      } else {
        snake.pop();
      }
      draw();
      movePending = false;
    };
    reset();
    draw();
    pauseGame();
    // Focus for keyboard
    setTimeout(()=>{snakeDiv.focus();},200);
  };
  window.slidingInit = function() {
    const slidingDiv = document.getElementById('game-sliding');
    if (!slidingDiv) return;
    // Prevent multiple initializations
    if (slidingDiv.getAttribute('data-initialized')) return;
    slidingDiv.setAttribute('data-initialized', '1');
    const gridSize = 3;
    const tileSize = 90;
    const gap = 2;
    const canvasSize = gridSize * tileSize + (gridSize - 1) * gap;
    // First mode: classic numbers, then images
    const modes = [
      { type: 'numbers' },
      { type: 'image', src: 'media/puz2.jpg' },
      { type: 'image', src: 'media/puz3.jpg' },
      { type: 'image', src: 'media/puz1.jpg' }
    ];
    let modeIndex = parseInt(localStorage.getItem('sliding-mode-idx')||'0',10) % modes.length;
    let img = null;
    if (modes[modeIndex].type === 'image') {
      img = new window.Image();
      img.src = modes[modeIndex].src;
    }
    let board = [];
    let empty = {x: gridSize - 1, y: gridSize - 1};
    let moves = 0;
    let best = parseInt(localStorage.getItem('sliding-best')||'0',10);
    let gameOver = false;
    function makeBoard() {
      board = [];
      let n = 1;
      for (let y = 0; y < gridSize; y++) {
        let row = [];
        for (let x = 0; x < gridSize; x++) {
          if (x === gridSize - 1 && y === gridSize - 1) row.push(0);
          else row.push(n++);
        }
        board.push(row);
      }
      empty = {x: gridSize - 1, y: gridSize - 1};
    }
    function shuffleBoard() {
      makeBoard();
      let lastDir = null;
      const dirs = [
        {x:0,y:-1}, // up
        {x:0,y:1},  // down
        {x:-1,y:0}, // left
        {x:1,y:0}   // right
      ];
      for (let i = 0; i < 200; i++) {
        let possible = dirs.filter((d, idx) => {
          let nx = empty.x + d.x, ny = empty.y + d.y;
          if (nx < 0 || nx >= gridSize || ny < 0 || ny >= gridSize) return false;
          if (lastDir !== null && (d.x === -lastDir.x && d.y === -lastDir.y)) return false;
          return true;
        });
        let dir = possible[Math.floor(Math.random() * possible.length)];
        let nx = empty.x + dir.x, ny = empty.y + dir.y;
        board[empty.y][empty.x] = board[ny][nx];
        board[ny][nx] = 0;
        empty = {x: nx, y: ny};
        lastDir = dir;
      }
    }
    function isSolved() {
      let n = 1;
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          if (x === gridSize - 1 && y === gridSize - 1) {
            if (board[y][x] !== 0) return false;
          } else {
            if (board[y][x] !== n++) return false;
          }
        }
      }
      return true;
    }
    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          let val = board[y][x];
          let px = x * (tileSize + gap);
          let py = y * (tileSize + gap);
          if (val !== 0) {
            if (modes[modeIndex].type === 'image' && img && img.complete) {
              // Draw image tile
              let tileNum = val - 1;
              let sx = (tileNum % gridSize) * (img.width / gridSize);
              let sy = Math.floor(tileNum / gridSize) * (img.height / gridSize);
              let sw = img.width / gridSize;
              let sh = img.height / gridSize;
              ctx.save();
              ctx.beginPath();
              ctx.moveTo(px, py);
              ctx.rect(px, py, tileSize, tileSize);
              ctx.closePath();
              ctx.clip();
              ctx.drawImage(img, sx, sy, sw, sh, px, py, tileSize, tileSize);
              ctx.restore();
            } else {
              // Draw number tile
              ctx.fillStyle = '#f2b179';
              ctx.fillRect(px, py, tileSize, tileSize);
              ctx.fillStyle = '#b30000';
              ctx.fillRect(px+2, py+2, tileSize-4, tileSize-4);
              ctx.fillStyle = '#fff';
              ctx.font = 'bold 2em Comic Neue, Arial';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              ctx.fillText(val, px + tileSize/2, py + tileSize/2);
            }
          } else {
            ctx.fillStyle = '#222';
            ctx.fillRect(px, py, tileSize, tileSize);
          }
        }
      }
    }
    function updateScore() {
      scoreDiv.textContent = 'Moves: ' + moves + ' | Best: ' + (best > 0 ? best : '-') ;
    }
    function tryMove(x, y) {
      if (gameOver) return;
      if ((Math.abs(x - empty.x) + Math.abs(y - empty.y)) === 1) {
        board[empty.y][empty.x] = board[y][x];
        board[y][x] = 0;
        empty = {x, y};
        moves++;
        updateScore();
        draw();
        if (isSolved()) {
          gameOver = true;
          if (best === 0 || moves < best) {
            best = moves;
            localStorage.setItem('sliding-best', best);
          }
          updateScore();
          setTimeout(()=>{
            alert('√úgyi-b√ºgyi!!!ü•∞');
            // Next image for next game
            nextImageAndRestart();
          }, 100);
        }
      }
    }
    function nextImageAndRestart() {
      modeIndex = (modeIndex + 1) % modes.length;
      localStorage.setItem('sliding-mode-idx', modeIndex);
      if (modes[modeIndex].type === 'image') {
        img = new window.Image();
        img.src = modes[modeIndex].src;
        img.onload = restart;
      } else {
        img = null;
        restart();
      }
    }
    function restart() {
      moves = 0;
      gameOver = false;
      shuffleBoard();
      updateScore();
      if (modes[modeIndex].type === 'image' && img) {
        if (img.complete) draw();
        else img.onload = draw;
      } else {
        draw();
      }
    }
    slidingDiv.innerHTML =
      `<div class="sliding-score" style="text-align:center;font-size:1em;margin:6px 0 2px 0;color:#b30000;font-weight:bold;">Moves: <span id="sliding-moves">0</span> | Best: <span id="sliding-best">-</span></div>` +
      `<canvas id="sliding-canvas" width="${canvasSize}" height="${canvasSize}" style="background:#222;border-radius:8px;display:block;margin:0 auto;"></canvas>` +
      '<div class="sliding-btns" style="display:flex;justify-content:center;gap:8px;margin:8px 0 0 0;width:100%;">' +
        '<button id="sliding-restart" style="background:#b30000;color:#fff;border:none;border-radius:4px;padding:4px 10px;font-size:1em;cursor:pointer;">üîÑ</button>' +
      '</div>';
    const canvas = document.getElementById('sliding-canvas');
    const ctx = canvas.getContext('2d');
    const scoreDiv = document.querySelector('.sliding-score');
    function updateScore() {
      document.getElementById('sliding-moves').textContent = moves;
      document.getElementById('sliding-best').textContent = best > 0 ? best : '-';
    }
    canvas.addEventListener('click', function(e) {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      const x = Math.floor(mx / (tileSize + gap));
      const y = Math.floor(my / (tileSize + gap));
      if (x >= 0 && x < gridSize && y >= 0 && y < gridSize) {
        tryMove(x, y);
      }
    });
    slidingDiv.tabIndex = 0;
    slidingDiv.onkeydown = e => {
      if (gameOver) return;
      let moved = false;
      if (e.key === 'ArrowUp' && empty.y < gridSize - 1) { tryMove(empty.x, empty.y + 1); moved = true; }
      if (e.key === 'ArrowDown' && empty.y > 0) { tryMove(empty.x, empty.y - 1); moved = true; }
      if (e.key === 'ArrowLeft' && empty.x < gridSize - 1) { tryMove(empty.x + 1, empty.y); moved = true; }
      if (e.key === 'ArrowRight' && empty.x > 0) { tryMove(empty.x - 1, empty.y); moved = true; }
      if (moved) e.preventDefault();
    };
    let sx=0,sy=0,ex=0,ey=0;
    canvas.addEventListener('touchstart',e=>{
      if (e.touches.length===1) {
        sx=e.touches[0].clientX; sy=e.touches[0].clientY;
      }
      e.stopPropagation();
    });
    canvas.addEventListener('touchend',e=>{
      ex=(e.changedTouches&&e.changedTouches[0])?e.changedTouches[0].clientX:0;
      ey=(e.changedTouches&&e.changedTouches[0])?e.changedTouches[0].clientY:0;
      const dx=ex-sx, dy=ey-sy;
      if (Math.abs(dx)>20||Math.abs(dy)>20) {
        if (Math.abs(dx)>Math.abs(dy)) {
          if (dx>0 && empty.x>0) tryMove(empty.x-1, empty.y);
          else if (dx<0 && empty.x<gridSize-1) tryMove(empty.x+1, empty.y);
        } else {
          if (dy>0 && empty.y>0) tryMove(empty.x, empty.y-1);
          else if (dy<0 && empty.y<gridSize-1) tryMove(empty.x, empty.y+1);
        }
      }
      e.stopPropagation();
    });
    document.getElementById('sliding-restart').onclick = () => nextImageAndRestart();
    if (modes[modeIndex].type === 'image' && img && !img.complete) {
      img.onload = restart;
    } else {
      restart();
    }
    setTimeout(()=>{slidingDiv.focus();},200);
  };

  // Default: show 2048
  const defaultBtn = document.querySelector('.game-select-btn[data-game="2048"]');
  if (defaultBtn) defaultBtn.click();
});

// Snow toggle logic
window.addEventListener('DOMContentLoaded', () => {
  const snowToggle = document.getElementById('snow-toggle');
  const snowCanvas = document.getElementById('snow-canvas');
  if (snowToggle && snowCanvas) {
    // Load saved state
    const snowOn = localStorage.getItem('snow-enabled');
    if (snowOn === null || snowOn === '1') {
      snowToggle.checked = true;
      snowCanvas.style.display = '';
    } else {
      snowToggle.checked = false;
      snowCanvas.style.display = 'none';
    }
    snowToggle.addEventListener('change', function() {
      if (this.checked) {
        snowCanvas.style.display = '';
        localStorage.setItem('snow-enabled', '1');
      } else {
        snowCanvas.style.display = 'none';
        localStorage.setItem('snow-enabled', '0');
      }
    });
  }
});

</script>
    <canvas id="snow-canvas" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:10002;"></canvas>
    <div id="loading-overlay">
    <span class="loading-message" style="font-weight:bold;">Julis Adventi Kalend√°riuma</span>
    <img src="media/app-icon-me.png" alt="Loading..." style="width:200px;height:200px;margin-bottom:20px;">
    <span class="loading-message" id="hihi-loading" style="font-weight:normal;"><span id="hihi-dots" style="display:inline-block;min-width:1.5em;padding-left:0;"></span></span>
    <div id="loading-powered-overlay">powered by gabo ¬©2025 | v04.07</div>
  </div>
  <div class="title-bg"><h1>üéÑJulis Adventi Kalend√°riumaüéÑ</h1></div>
  <div class="calendar" id="calendar"></div>
  <!-- General Content Overlay (for all days except 6 and 24) -->
  <div id="content-overlay" style="display:none;position:fixed;z-index:10001;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.65);backdrop-filter:blur(2px);justify-content:center;align-items:center;flex-direction:column;">
      <div id="content-overlay-center">
        <!-- Content will be injected here -->
      </div>
      <button id="close-content-btn" style="position:fixed;bottom:32px;left:50%;transform:translateX(-50%);z-index:10002;font-family:'Comic Neue',Arial,sans-serif;font-size:1.1em;padding:10px 28px;background:#b30000;color:#fff;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.12);cursor:pointer;">Kalend√°rium</button>
  </div>
  <!-- Santa Day 6 Overlay (hidden by default) -->
  <div id="santa-overlay" style="display:none;position:fixed;z-index:10001;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.65);backdrop-filter:blur(2px);justify-content:center;align-items:center;flex-direction:column;">
    <div id="santa-overlay-top" style="width:100%;display:flex;justify-content:center;align-items:center;margin-top:32px;margin-bottom:10px;"></div>
    <div id="santa-overlay-center" style="display:flex;justify-content:center;align-items:center;min-height:180px;"></div>
    <div id="santa-overlay-bottom" style="width:100%;display:flex;justify-content:center;align-items:center;margin-top:18px;"></div>
  </div>
  <!-- Xmas Day 24 Overlay (hidden by default) -->
  <div id="xmas-overlay" style="display:none;position:fixed;z-index:10001;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.65);backdrop-filter:blur(2px);justify-content:center;align-items:center;flex-direction:column;">
    <div id="xmas-overlay-top" style="width:100%;display:flex;justify-content:center;align-items:center;margin-top:32px;margin-bottom:10px;"></div>
    <div id="xmas-overlay-center" style="display:flex;justify-content:center;align-items:center;min-height:180px;"></div>
    <div id="xmas-overlay-bottom" style="width:100%;display:flex;justify-content:center;align-items:center;margin-top:18px;"></div>
  </div>

<script>
  // Typewriter effect for 'hihi...': run two cycles
  window.addEventListener('DOMContentLoaded', () => {
    const hihiLoading = document.getElementById('hihi-loading');
    const fullText = 'hihi...';
    let cycle = 0;
    function runTypewriter() {
      let idx = 0;
      const paddedText = ' hihi...';
      // Use monospace font and a transparent span to reserve space
        hihiLoading.style.fontFamily = 'Comic Neue, Consolas, Menlo, Monaco, monospace';
        hihiLoading.style.letterSpacing = '0.04em';
        hihiLoading.style.fontWeight = 'normal';
        hihiLoading.style.fontSize = '1em';
        hihiLoading.style.display = 'block';
        hihiLoading.style.position = 'relative';
        hihiLoading.style.textAlign = 'center';
        hihiLoading.style.width = '8.5ch'; // width for ' hihi...'
        hihiLoading.style.margin = '0 auto';
        hihiLoading.innerHTML = `<span id="hihi-placeholder" style="opacity:0;font-size:0.85em;font-weight:normal;">${paddedText}</span><span id="hihi-type" style="font-weight:normal;font-size:0.85em;position:absolute;left:0;top:0;width:100%;text-align:center;"></span>`;
        const typeSpan = document.getElementById('hihi-type');
      let typeInterval = setInterval(() => {
        idx++;
        typeSpan.textContent = paddedText.slice(0, idx);
        if (idx === paddedText.length) {
          clearInterval(typeInterval);
          cycle++;
          if (cycle < 2) {
            setTimeout(runTypewriter, 400); // short pause before next cycle
          } else {
            setTimeout(() => {
              const overlay = document.getElementById('loading-overlay');
              overlay.style.opacity = 0;
              // Keep #loading-powered visible during fade-out
              const powered = document.getElementById('loading-powered-overlay');
              if (powered) powered.style.opacity = 1;
              setTimeout(() => {
                overlay.style.display = 'none';
                if (powered) powered.style.opacity = 0.7; // restore default after fade
              }, 300);
            }, 800);
          }
        }
      }, 180);
    }
    runTypewriter();
  });
// Simple snow effect overlay
window.addEventListener('DOMContentLoaded', () => {
  const canvas = document.getElementById('snow-canvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let width = window.innerWidth;
  let height = window.innerHeight;
  function resizeCanvas() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  // Snowflake properties
  const flakes = [];
  const flakeCount = Math.max(60, Math.floor(width * height / 3500));
  for (let i = 0; i < flakeCount; i++) {
    flakes.push({
      x: Math.random() * width,
      y: Math.random() * height,
      r: 1.2 + Math.random() * 2.2,
      d: 0.7 + Math.random() * 1.3,
      a: Math.random() * Math.PI * 2,
      speed: 0.4 + Math.random() * 1.0,
      opacity: 0.45 + Math.random() * 0.45 // Varying opacity
    });
  }
  function drawSnow() {
    ctx.clearRect(0, 0, width, height);
    flakes.forEach(f => {
      // Soft blurred snowflake using radial gradient
      const grad = ctx.createRadialGradient(f.x, f.y, 0, f.x, f.y, f.r * 2.2);
      grad.addColorStop(0, `rgba(255,255,255,${f.opacity})`);
      grad.addColorStop(0.5, `rgba(255,255,255,${f.opacity * 0.7})`);
      grad.addColorStop(1, 'rgba(255,255,255,0)');
      ctx.beginPath();
      ctx.arc(f.x, f.y, f.r * 2.2, 0, Math.PI * 2);
      ctx.fillStyle = grad;
      ctx.fill();
    });
  }
  function updateSnow() {
    for (let f of flakes) {
      f.y += f.speed * f.d;
      f.x += Math.sin(f.a) * 0.6;
      f.a += 0.01 + Math.random() * 0.01;
      if (f.y > height + 4) {
        f.y = -4;
        f.x = Math.random() * width;
      }
      if (f.x > width + 4) f.x = -4;
      if (f.x < -4) f.x = width + 4;
    }
  }
  function animateSnow() {
    updateSnow();
    drawSnow();
    requestAnimationFrame(animateSnow);
  }
  animateSnow();
});
</script>

<script>
    const contentData = {
      1: { title: "1. Szia Julis!:)", text: "√údv az adventi kalend√°riumodban!\nMinden napra jut majd egy kis meglepet√©s, hihi.\n Az els≈ë maga az applik√°ci√≥, rem√©lem tetszik:)\nPusziii!!!ü•∞", image: "media/coding.jpg", link: "", video: "" },
      2: { title: "2. √úgyi-b√ºgyi vagy...", text: "...hogy ma is visszat√©rt√©l:)!\n Jutalmad egy kis k√°v√©p√©nz-t√°mogat√°s (√≠gy h√≥ v√©ge fel√© k√∂zeledve), hogy nyitva tudd tartani ma a szemeidet √≥r√°n.\nCheckold a Revolutod!", image: "media/coffee.png", link: "", video: "" },
      3: { title: "3. 3 h√≥napja...", text: "...tal√°lkoztunk el≈ësz√∂r kettesben!:) Durva, mennyi minden t√∂rt√©nt az√≥ta:)\n A havi kis bor√≠t√©kod nem marad el, majd odaadom, ha tal√°lkozunk!:)\nUi.: Ma este egy g√∂rg≈ëz√©s?üòé", image: "media/0903.jpg", link: "", video: "" },
      4: { title: "4. J√≥ reggelt!", text: "√úgyes legy√©l ma a susuban!:)", image: "", link: "", video: "media/wakey.mp4" },
      5: { title: "5. Grafilogika:)", text: "Ma egy kis feladv√°nyt kapsz, rem√©lem ki tudod sz√≠nesben nyomtatni.\n Viel Spa√ü!:)<br><a href='https://drive.google.com/file/d/1hQnBsPC27ZBde7qkPaNAs_L4dANv0pTG/view?usp=drive_link' target='_blank'>Nyomtat√°s</a>", image: "media/nonogramm.png", link: "", video: "" },
      6: { title: "6. Ho-ho-ho-hooo!üéÖ", text: "Rem√©lem j√≥l viselkedt√©l az √©vben, kedves Julis!\nSiker√ºlt megoldani a grafilogik√°t?:)", image: "", link: "", video: "" },
      7: { title: "7. Nagyon-nagyon!", text: 'Bocsi, most r√°mj√∂tt. Legyen sz√©p napod! Szeretlek!‚ù§Ô∏è', image: "media/collage.jpg", link: "", video: "media/els≈ëre.mp4" },
      8: { title: "8. Bolond√≥ra!", text: "El≈ësz√∂r is hajr√° ma a vizsg√°n!:)\n Viszont Julis, ma sem maradhat el a bolond√≥ra! Bukfencezgess p√°rat a lak√°sban:) Ha k√©sz√ºl r√≥la vide√≥, sz√≠vesen veszem:)!", image: "media/bukfenc.gif", link: "", video: "" },
      9: { title: "9. Egy kis motiv√°ci√≥ reggelre!", text: "Gyer√ºnk Julis, √ºgyes leszel ma!ü§ò\nRopjad neki!", image: "", link: "", video: "media/fish.mp4" },
      10: { title: "10. A mai meglepet√©s pedig...", text: "... √©n leszek!:)\nNa j√≥, ennyire az√©rt nem kell repdesned az √∂r√∂mt≈ël.\nV√©gre √∫jra tal√°lkozunk, v√°√°√°√°√°√°√°√°√°√°!", image: "media/lederhose2.jpg", link: "", video: "" },
      11: { title: "11. Fut√°√°√°s", text: "Julisom, ma olyan r√©szt√°vokat futunk, amilyet csak szeretn√©l;)", image: "media/run.jpeg", link: "", video: "" },
      12: { title: "12. Kar√°csonyi v√°s√°r", text: "Ma v√°laszthatsz b√°rmit a kar√°csonyi v√°s√°rban, ami megtetszik!:)", image: "media/christkindl.jpg", link: "", video: "" },
      13: { title: "13. Setem√©ny", text: "Ma vend√©gem vagy egy s√ºtire. Pusszancs!", image: "media/suti.jpg", link: "", video: "" },
      14: { title: "14. B√∫cs√∫:(", text: "K√°r, hogy m√©szü•∫ De hamarosan √∫jra egy√ºtt!‚ò∫Ô∏è\n B√∫cs√∫z√≥ul megiszunk ma egy forralt bort a v√°rosban, mit sz√≥lsz?:)", image: "media/gluhwein.jpg", link: "", video: "" },
      15: { title: "15. Hihi!", text: "A mai meglepi egy mozijegy!\nMikor megy√ºnk???üòè", image: "media/zootopia.jpg", link: "", video: "" },
      16: { title: "16. Hupsz...", text: "Julisom, az √©let nem mindig habostorta! N√©ha meg kell √°llni, √©s √©rt√©kelni mindazt, ami megadatott. Nem szabad telhetetlennek lenni.", image: "media/hupsz.jpg", link: "", video: "" },
      17: { title: "17. J√≥ √©jszak√°t!", text: 'Ma est√©re k√ºld√∂k neked egy kis szeretetcsomagotü´∂<br>Sz√©p √°lmokat!', image: "media/sleep.jpg", link: "", video: "media/macsk√°k.mp4" },
      18: { title: "18. Kitart√°st...", text: "...m√©g az utols√≥ napokra:)\nBerci is szeretett volna √ºzenni a kalend√°riumban neked, ≈ët kapcsolom most:)", image: "media/berci.jpg", link: "", video: "" },
      19: { title: "19. Titkos recept", text: "Ma a paszulyleves receptj√©t kapod t≈ëlem, csak hogy ha megszoruln√°l esetleg, √©s kifogyna minden a m√©lyh≈±t≈ëb≈ël...\n\nHozz√°val√≥k 4 szem√©lyre\n50 dkg sz√°razPASZULY !!! (feh√©r vagy tarka)\n1 fej v√∂r√∂shagyma\n1 sz√°l MUROK !!!\n1 sz√°l petrezselyemgy√∂k√©r\nkev√©s zellergy√∂k√©r\n3-4 db bab√©rlev√©l\n1 kan√°l ecetes t√°rkony\n20 dkg f√ºst√∂lt kolb√°sz\n2 kan√°l zs√≠r (vagy olaj)\n2 kan√°l liszt\n1 kk. pirospaprika\n3 dl zs√≠ros tej\ns√≥, bors\nJ√≥ √©tv√°gyat!", image: "media/cook.jpg", link: "", video: "media/paszuly.mp4" },
      20: { title: "20. Meglepet√©s", text: "Szio! Rem√©lem ma tal√°lkozunk, √©s odaadhatom a cuki meglepet√©semet:)", image: "media/gift.png", link: "", video: "" },
      21: { title: "21. Hal√≥!", text: "Rem√©lem ma veled √©bredek!:)\n Mit sz√≥ln√°l hozz√°, ha elmenn√©k ma egy j√≥ helyre eb√©delni?ü§å", image: "media/salve.jpg", link: "", video: "" },
      22: { title: "22. Eml√©keztet≈ë...", text: "...arra, hogy mennyire sziper-szuper √ºgyes vagy!üèÜ\nB√ºszke lehetsz magadra!:)\n√ân az vagyok r√°d!ü•π", image: "media/ranglista.png", link: "", video: "" },
      23: { title: "23. Eml√©keztet≈ë 2...", text: "...arra, hogy n√°lad t√©nyleg!\n√ñlellek, puszillak, szeretlek!‚ù§Ô∏è\nKellemes √ºnnepeket!", image: "media/julis.jpg", link: "", video: "media/nalad-tenyleg.mp4" },
      24: { title: "24. Boldog kar√°csonyt!", text: "Legyen sz√©p napod ma a csal√°doddal, Julis!üéÅ\nRem√©lem tetszett ez a kis kalend√°rium.\n√ân G√°bor voltam, a te kis g√∂mb√∂c√∂d, pusziii!!!ü•∞", image: "media/bercixmas.jpg", link: "", video: "" },
    };

  // Customizable: set how many doors can be opened (0 = use normal logic, 1-24 = open up to that day)
  const OPEN_DAYS = 0; // e.g., set to 5 to open first 5 days, 24 to open all, 0 for normal logic
  // DEV mode: set to true to unlock all doors
  const DEV = false; // set to true for development
  const today = new Date();
  let currentDay;
  if (OPEN_DAYS > 0) {
    currentDay = OPEN_DAYS;
  } else if (DEV) {
    currentDay = 24;
  } else {
    // If today is after December 24, 2025, open all doors
    const unlockDate = new Date(2025, 11, 24, 23, 59, 59); // December is month 11
    if (today > unlockDate) {
      currentDay = 24;
    } else {
      // Open doors up to today's date if in the current month, else 0
      const calendarMonth = today.getMonth(); // Use current month
      currentDay = (today.getMonth() === calendarMonth ? today.getDate() : 0);
    }
  }

  const calendar = document.getElementById("calendar");
  const contentOverlay = document.getElementById("content-overlay");
  const contentOverlayCenter = document.getElementById("content-overlay-center");
  const contentOverlayBottom = document.getElementById("content-overlay-bottom");

  // Track locked box click counts in session
  const lockedBoxClicks = {};
  function showLockedMessage(day) {
    lockedBoxClicks[day] = (lockedBoxClicks[day] || 0) + 1;
    if (lockedBoxClicks[day] === 1) {
      alert("H√©k√°s! Csak ne olyan hevesen! Legyen mi√©rt v√°rni a holnapot is!;)üéÅ");
    } else {
      alert("Csak nem b√≠r mag√°val...üòà a j√≥ dolgokra n√©ha v√°rni kell, Julis! De meg√©ri!:)");
    }
  }

  for (let day = 1; day <= 24; day++) {
    const door = document.createElement("div");
    door.className = "door";
    door.textContent = day;

    const openedKey = 'advent-opened-' + day;
    const isOpened = localStorage.getItem(openedKey) === '1';

    if (day > currentDay) {
      door.classList.add("locked");
      door.addEventListener("click", () => {
        door.classList.add('shake');
        if (window.navigator.vibrate) window.navigator.vibrate(350);
        setTimeout(() => {
          door.classList.remove('shake');
          showLockedMessage(day);
        }, 350);
      });
    } else {
      door.classList.add('available');
      // Only the current day's box pulses until opened
      if (day === currentDay && !isOpened) {
        door.classList.add('pulse');
      }
      door.addEventListener("click", () => {
        // Custom vibration pattern: triple pulse
        if (window.navigator.vibrate) window.navigator.vibrate([200, 100, 200, 100, 200]);
        door.classList.remove('pulse');
        door.classList.add('scale-up');
        setTimeout(() => {
          door.classList.remove('scale-up');
          door.classList.add('bounce');
          setTimeout(() => {
            door.classList.remove('bounce');
            setTimeout(() => {
              // Toggle open door content for any available day (now using overlay)
              const expectedHtml = `<h1>${contentData[day].title || (day + '. nap')}</h1><p>${contentData[day].text.replace(/\n/g, '<br>')}</p>` +
                (contentData[day].image ? `<img src="${contentData[day].image}" style="display:block;margin:10px auto;">` : '') +
                (contentData[day].link ? `<p><a href="${contentData[day].link}" target="_blank">Open link</a></p>` : '') +
                (contentData[day].video ? `<video controls src="${contentData[day].video}" style="width:100%"></video>` : '');
              if (contentOverlay.style.display === "flex" && contentOverlayCenter.innerHTML.trim() === expectedHtml.trim()) {
                contentOverlay.style.display = "none";
              } else {
                openDoor(day);
                localStorage.setItem(openedKey, '1');
              }
            }, 400); // Extra 0.4s delay after bounce
          }, 300); // Wait for bounce animation to finish
        }, 300); // Wait for scale-up animation to finish
      });
    }

    calendar.appendChild(door);
  }

  function openDoor(day) {
    const data = contentData[day];
    // Special content for day 6
    if (day === 6) {
      document.getElementById('calendar').style.filter = 'blur(2px)';
      contentOverlay.style.display = 'none';
      const overlay = document.getElementById('santa-overlay');
      overlay.style.display = 'flex';
      document.getElementById('santa-overlay-top').innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;width:100%"><h1 style="color:#fff;text-shadow:1px 1px 4px #b30000,0 0 2px #000;font-family:\'Comic Neue\',Arial,sans-serif;font-size:2em;margin:0 0 8px 0;">Boldog Mikul√°st!</h1><img src="media/santa-reindeer.gif" alt="Santa Reindeer"></div>';
      document.getElementById('santa-overlay-center').innerHTML = '<img id="santa-claus-img" src="media/santa-claus.png" alt="Santa Claus">';
      document.getElementById('santa-overlay-bottom').innerHTML = `
        <div style="display:flex;flex-direction:column;align-items:center;width:100%;">
          <button id="juhuuu-btn">juhuuuu!!!</button>
            <button id="santa-fake-btn" style="margin-top:-20px;background:#888;color:#fff;font-family:'Comic Neue',Arial,sans-serif;font-size:1em;padding:8px 18px;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.10);cursor:pointer;">A Mikul√°s nem is l√©tezik...</button>
        </div>
      `;
      setTimeout(() => {
        const santaImg = document.getElementById('santa-claus-img');
        if (santaImg) {
          santaImg.style.opacity = 1;
          santaImg.animate([
            { transform: 'scale(0.2)' },
            { transform: 'scale(1.08)' },
            { transform: 'scale(0.94)' },
            { transform: 'scale(1.08)' },
            { transform: 'scale(0.94)' },
            { transform: 'scale(1.08)' },
            { transform: 'scale(0.94)' },
            { transform: 'scale(1.05)' },
            { transform: 'scale(0.96)' },
            { transform: 'scale(1)' }
          ], {
            duration: 1800,
            easing: 'cubic-bezier(.45,0,.55,1)',
            fill: 'forwards'
          });
        }
      }, 100);
      setTimeout(() => {
        const btn = document.getElementById('juhuuu-btn');
        if (btn) {
          btn.onclick = () => {
            document.getElementById('santa-overlay').style.display = 'none';
            document.getElementById('calendar').style.filter = '';
            // Show content overlay for day 6
            let html = `<h1>${contentData[6].title || '6. nap'}</h1><p>${contentData[6].text.replace(/\n/g, '<br>')}</p>`;
            contentOverlayCenter.innerHTML = html;
            contentOverlay.style.display = 'flex';
            document.getElementById('close-content-btn').onclick = () => {
              contentOverlay.style.display = 'none';
            };
            };
        }
        // Add handler for the "A Mikul√°s nem is l√©tezik" button
        const fakeBtn = document.getElementById('santa-fake-btn');
        if (fakeBtn) {
          fakeBtn.onclick = () => {
            alert("Most mi√©rt kell mindent elrontani?:(\nNa puszi...");
            setTimeout(() => {
              window.close();
            }, 300);
          };
        }
      }, 200);
      return;
    }
    // Special content for day 24
    if (day === 24) {
      document.getElementById('calendar').style.filter = 'blur(2px)';
      contentOverlay.style.display = 'none';
      const overlay = document.getElementById('xmas-overlay');
      overlay.style.display = 'flex';
      document.getElementById('xmas-overlay-top').innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;width:100%"><h1 style="color:#fff;text-shadow:1px 1px 4px #b30000,0 0 2px #000;font-family:\'Comic Neue\',Arial,sans-serif;font-size:2em;margin:0 0 8px 0;">Boldog kar√°csonyt!</h1><img src="media/lights2.gif" alt="Christmas Lights"></div>';
      document.getElementById('xmas-overlay-center').innerHTML = '<img id="xmas-img" src="media/xmas.png" alt="Christmas">';
      document.getElementById('xmas-overlay-bottom').innerHTML = '<button id="xmas-btn">juhuuuu!!!</button>';
      setTimeout(() => {
        const xmasImg = document.getElementById('xmas-img');
        if (xmasImg) {
          xmasImg.style.opacity = 1;
          xmasImg.animate([
            { transform: 'scale(0.2)' },
            { transform: 'scale(1.08)' },
            { transform: 'scale(0.94)' },
            { transform: 'scale(1.08)' },
            { transform: 'scale(0.94)' },
            { transform: 'scale(1.08)' },
            { transform: 'scale(0.94)' },
            { transform: 'scale(1.05)' },
            { transform: 'scale(0.96)' },
            { transform: 'scale(1)' }
          ], {
            duration: 1800,
            easing: 'cubic-bezier(.45,0,.55,1)',
            fill: 'forwards'
          });
        }
      }, 100);
      setTimeout(() => {
        const btn = document.getElementById('xmas-btn');
        if (btn) {
          btn.onclick = () => {
            document.getElementById('xmas-overlay').style.display = 'none';
            document.getElementById('calendar').style.filter = '';
            // Show content overlay for day 24
            let html = `<h1>${contentData[24].title || '24. nap'}</h1><p>${contentData[24].text.replace(/\n/g, '<br>')}</p>`;
            if (contentData[24].image) html += `<img src="${contentData[24].image}" style="display:block;margin:10px auto;">`;
            if (contentData[24].link) html += `<p><a href="${contentData[24].link}" target="_blank">Open link</a></p>`;
            if (contentData[24].video) html += `<video controls src="${contentData[24].video}" style="width:100%"></video>`;
            contentOverlayCenter.innerHTML = html;
            contentOverlay.style.display = 'flex';
            document.getElementById('close-content-btn').onclick = () => {
              contentOverlay.style.display = 'none';
            };
            };
        }
      }, 200);
      return;
    }
    // Default content for other days (now as overlay)
    let html = `<h1>${data.title || (day + '. nap')}</h1><p>${data.text.replace(/\n/g, '<br>')}</p>`;
    if (data.image) html += `<img src="${data.image}" style="display:block;margin:10px auto;width:100%;height:auto;">`;
    if (data.link) html += `<p><a href="${data.link}" target="_blank">Open link</a></p>`;
    if (data.video) html += `<video controls src="${data.video}" style="width:100%"></video>`;
    contentOverlayCenter.innerHTML = html;
    contentOverlay.style.display = "flex";
    document.getElementById('close-content-btn').onclick = () => {
      contentOverlay.style.display = 'none';
    };
};
</script>
    <div id="loading-powered" style="position:fixed;bottom:8px;left:0;width:100vw;text-align:center;font-size:0.8em;color:#fff;opacity:0.7;letter-spacing:1px;font-family:'Fira Mono','Consolas','Menlo','Monaco',monospace;pointer-events:none;z-index:100;">powered by gabo ¬©2025 | v04.07  </div>
</body>
</html>
